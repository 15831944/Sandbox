<!DOCTYPE HTML>
<html lang="en">
<head>
<title>Move Line</title>
<meta charset = "UTF-8"/>

<!-- Update the path to paper js -->
<script type="text/javascript" src="raphael.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>

<style type="text/css">
svg {
    border: solid 1px #000;
}
</style>

</head>
<body>
<div id="canvas"></div>
<button type="button" id="clearBtn">Clear</button>
</body>
</html>

<script type="text/javascript"> 
    //<![CDATA[
    var CANVAS_WIDTH = 800;
    var CANVAS_HEIGHT = 800;
    var LINE_WIDTH = 5;
    var CONTROL_POINT_RADIOUS = 10;

    function Line(startX, startY, endX, endY, paper) {
        var start = {
            x: startX,
            y: startY
        };
        var end = {
            x: endX,
            y: endY
        };

        Line.prototype.updateStart = function (x, y) {
            start.x = x;
            start.y = y;
            redraw();
            return this;
        }

        Line.prototype.updateEnd = function (x, y) {
            end.x = x;
            end.y = y;
            redraw();
            return this;
        }

        Line.prototype.enableEdit = function () {
            node.mouseover(function () {
                node.attr("stroke", "blue");
                // Show the control points
                controls = paper.set(
                                paper.circle(start.x, start.y, CONTROL_POINT_RADIOUS),
                                paper.circle(end.x, end.y, CONTROL_POINT_RADIOUS)
                                );
                controls.attr({ fill: "yellow" });
            });
            node.mouseout(function () {
                node.attr("stroke", "red");
                // Clear the control points
                controls.remove();
            });

        }

        var getPath = function () {
            return "M" + start.x + " " + start.y + " L" + end.x + " " + end.y;
        };

        var node = paper.path(getPath());

        var controls = paper.set();

        var redraw = function () {
            node.attr("path", getPath());
            node.attr("stroke", "red");
            node.attr("stroke-width", LINE_WIDTH);
        }
    };

    $(document).ready(function () {
        var paper = Raphael("canvas", CANVAS_WIDTH, CANVAS_HEIGHT);
        var line;
        $("#canvas").dblclick(function (e) {
            x = e.offsetX;
            y = e.offsetY;
            line = new Line(x, y, x, y, paper);
            $("#canvas").bind("mousemove", function (e) {
                x = e.offsetX;
                y = e.offsetY;
                line = line.updateEnd(x, y);
            });
        });

        $("#canvas").mouseup(function (e) {
            $("#canvas").unbind("mousemove");
            if (line != undefined)
                line.enableEdit();
        });

        $("#clearBtn").click(function () {
            paper.clear();
        })
    });
    //]]> 
</script>